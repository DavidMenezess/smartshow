<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Show - Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Smart Show</h1>
            <div class="user-info">
                <span id="userName">Usuário</span>
                <button id="logoutBtn" class="btn btn-secondary">Sair</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <a href="index.html" class="nav-item active">Dashboard</a>
            <a href="caixa.html" class="nav-item">Caixa</a>
            <a href="produtos.html" class="nav-item">Produtos</a>
            <a href="clientes.html" class="nav-item">Clientes</a>
            <a href="assistencia.html" class="nav-item">Assistência</a>
            <a href="financeiro.html" class="nav-item">Financeiro</a>
            <a href="relatorios.html" class="nav-item">Relatórios</a>
            <a href="configuracao.html" class="nav-item" id="configNavItem" style="display: none;">Configuração</a>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 style="margin: 0;">Dashboard</h2>
                <div id="storeSelectorContainer" style="display: none; display: flex; align-items: center; gap: 0.75rem; background: #f7fafc; padding: 0.75rem 1.25rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label style="font-weight: 600; color: #2d3748; font-size: 0.95rem;">Loja:</label>
                    </div>
                    <select id="storeSelector" style="padding: 0.625rem 1.25rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.95rem; min-width: 220px; background: white; color: #2d3748; font-weight: 500; cursor: pointer; transition: all 0.2s; outline: none;" onfocus="this.style.borderColor='#FFD700'; this.style.boxShadow='0 0 0 3px rgba(255, 215, 0, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                        <option value="">Todas as Lojas</option>
                    </select>
                    <button id="compareStoresBtn" class="btn btn-secondary" style="margin-left: 0; padding: 0.625rem 1.25rem; border-radius: 8px; font-weight: 600; display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)'">Comparar Lojas</button>
                </div>
            </div>
            
            <!-- Modal de Comparação -->
            <div id="compareModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 900px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem 2rem;">
                        <h3 style="margin: 0; font-size: 1.5rem; font-weight: 700;">Comparação de Lojas</h3>
                        <span class="close" onclick="closeCompareModal()" style="color: white; font-size: 2rem; opacity: 0.9; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.9'">&times;</span>
                    </div>
                    <div style="padding: 2rem; background: #f7fafc;">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 1rem; font-weight: 600; color: #2d3748; font-size: 1.1rem;">Selecione as lojas para comparar:</label>
                            <div id="compareStoresCheckboxes" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1rem;">
                                <!-- Checkboxes serão adicionados dinamicamente -->
                            </div>
                        </div>
                        <div style="text-align: right; margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid #e2e8f0;">
                            <button class="btn btn-secondary" onclick="closeCompareModal()" style="margin-right: 0.75rem; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; background: #e2e8f0; color: #4a5568; border: none; transition: all 0.2s;" onmouseover="this.style.background='#cbd5e0'" onmouseout="this.style.background='#e2e8f0'">Cancelar</button>
                            <button class="btn btn-primary" onclick="applyComparison()" style="padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)'">✅ Comparar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área Normal (quando não está comparando) -->
            <div id="normalDashboardArea">
            <!-- Cards de Resumo -->
            <div class="dashboard-grid">
                <div class="card">
                    <h3>Vendas Hoje</h3>
                    <div class="card-value" id="todaySales">R$ 0,00</div>
                    <div class="card-count" id="todaySalesCount">0 vendas</div>
                </div>

                <div class="card">
                    <h3>Vendas do Mês</h3>
                    <div class="card-value" id="monthSales">R$ 0,00</div>
                    <div class="card-count" id="monthSalesCount">0 vendas</div>
                </div>

                <div class="card">
                    <h3>Estoque Baixo</h3>
                    <div class="card-value" id="lowStock">0</div>
                    <div class="card-count">produtos</div>
                </div>

                <div class="card">
                    <h3>Contas a Receber</h3>
                    <div class="card-value" id="receivable">R$ 0,00</div>
                    <div class="card-count" id="receivableCount">0 contas</div>
                </div>

                <div class="card">
                    <h3>Contas a Pagar</h3>
                    <div class="card-value" id="payable">R$ 0,00</div>
                    <div class="card-count" id="payableCount">0 contas</div>
                </div>

                <!-- Cards de OS por Status -->
                <div class="card">
                    <h3>OS Prontas</h3>
                    <div class="card-value" id="osPronta">0</div>
                    <div class="card-count">ordens</div>
                </div>
                <div class="card">
                    <h3>Aguardando Autorização</h3>
                    <div class="card-value" id="osAguardandoAutorizacao">0</div>
                    <div class="card-count">ordens</div>
                </div>
                <div class="card">
                    <h3>Sem Concerto</h3>
                    <div class="card-value" id="osSemConcerto">0</div>
                    <div class="card-count">ordens</div>
                </div>
                <div class="card">
                    <h3>Entregue</h3>
                    <div class="card-value" id="osEntregue">0</div>
                    <div class="card-count">ordens</div>
                </div>
                <div class="card">
                    <h3>Em Manutenção</h3>
                    <div class="card-value" id="osEmManutencao">0</div>
                    <div class="card-count">ordens</div>
                </div>
                <div class="card">
                    <h3>Aguardando Peça</h3>
                    <div class="card-value" id="osAguardandoPeca">0</div>
                    <div class="card-count">ordens</div>
                </div>
            </div>

            <!-- Gráficos -->
            <div class="dashboard-charts" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div class="chart-card">
                    <h3>Vendas dos Últimos 7 Dias</h3>
                    <canvas id="salesChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Vendas por Forma de Pagamento</h3>
                    <canvas id="paymentChart"></canvas>
                </div>
            </div>

            <!-- Tabelas -->
            <div class="dashboard-charts">
                <div class="chart-card">
                    <h3>Vendas Recentes</h3>
                    <div id="recentSales" class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Nº Venda</th>
                                    <th>Cliente</th>
                                    <th>Vendedor</th>
                                    <th>Forma de Pagamento</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="recentSalesBody">
                                <tr><td colspan="6">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            </div>

            <!-- Área de Comparação (quando está comparando lojas) -->
            <div id="comparisonArea" style="display: none;">
                <h3 style="margin-bottom: 1.5rem; color: #2d3748; font-size: 1.5rem;">Comparativo entre Lojas</h3>
                
                <!-- Cards Comparativos -->
                <div id="comparisonCards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <!-- Cards serão gerados dinamicamente -->
                </div>
                
                <!-- Gráficos Comparativos -->
                <div class="dashboard-charts" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div class="chart-card">
                        <h3>Vendas dos Últimos 7 Dias - Comparativo</h3>
                        <canvas id="comparisonSalesChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Vendas por Forma de Pagamento - Comparativo</h3>
                        <canvas id="comparisonPaymentChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Produtos com Estoque Baixo -->
            <div class="dashboard-charts" style="margin-top: 2rem;">
                <div class="chart-card">
                    <h3>Produtos com Estoque Baixo</h3>
                    <div id="lowStockProducts" class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Loja</th>
                                    <th>Produto</th>
                                    <th>Código de Barras</th>
                                    <th>Estoque Atual</th>
                                    <th>Estoque Mínimo</th>
                                    <th>Preço de Venda</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockProductsBody">
                                <tr><td colspan="6">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/access-control.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>



